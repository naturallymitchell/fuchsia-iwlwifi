# Copyright (c) 2019 The Fuchsia Authors.
#
# Permission to use, copy, modify, and/or distribute this software for any
# purpose with or without fee is hereby granted, provided that the above
# copyright notice and this permission notice appear in all copies.
#
# THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
# WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
# MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
# ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
# WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
# ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
# OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

import("//build/package.gni")
import("//build/test/test_package.gni")
import("//build/testing/environments.gni")

group("test") {
  testonly = true
  deps = [
    ":iwlwifi_test",
  ]
}

testing_deps = [
  "//src/connectivity/wlan/drivers/third_party/intel/iwlwifi:pcie",
  "//src/connectivity/wlan/drivers/third_party/intel/iwlwifi:iwlwifi_sim_trans_ss",
  "//src/lib/fxl/test:gtest_main",
  "//third_party/googletest:gmock",
]

# The dummy code for developer to start a new test.
executable("dummy_test") {
  output_name = "dummy_test"
  testonly = true

  sources = [
    "dummy_test.cc",
  ]

  deps = testing_deps
}

# Test code for MVM features.
executable("mvm_test") {
  output_name = "mvm_test"
  testonly = true

  sources = [
    "mvm_test.cc",
  ]

  deps = testing_deps
}

executable("pcie_test") {
  output_name = "pcie_test"
  testonly = true

  sources = [
    "pcie_test.cc",
  ]

  deps = testing_deps
}

executable("utils_test") {
  output_name = "utils_test"
  testonly = true

  sources = [
    "utils_test.cc",
  ]

  deps = testing_deps
}

unittest_package("iwlwifi_test") {
  package_name = "iwlwifi_test"

  deps = [
    ":dummy_test",
    ":mvm_test",
    ":pcie_test",
    ":utils_test",
  ]

  tests = [
    {
      name = "dummy_test"
      environments = basic_envs
    },
    {
      name = "mvm_test"
      environments = basic_envs
    },
    {
      name = "pcie_test"
      environments = basic_envs
    },
    {
      name = "utils_test"
      environments = basic_envs
    },
  ]
}
